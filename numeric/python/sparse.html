

<!DOCTYPE html>


<html lang="fr" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>2.1. Matrices Creuses &#8212; Recueil d&#39;Exercices Classiques de Mathématiques</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../../_static/translations.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>window.MathJax = {"tex": {"macros": {"dsp": "{\\displaystyle}", "gD": "{g_D}", "gN": "{g_N}", "GammaN": "{\\Gamma_N}", "GammaD": "{\\Gamma_D}", "GammaF": "\\Gamma_F", "Lo": "{L^2(\\Omega)}", "Ho": "{H^1(\\Omega)}", "Hoz": "{H^1_{0}(\\Omega)}", "HoD": "{H^1_{\\GammaD}(\\Omega)}", "Hog": "{H^1_{\\gD}(\\Omega)}", "Hoo": "{H^2(\\Omega)}", "Vh": "{V_h}", "Vhz": "{V_{h,0}}", "VhD": "{V_{h,\\GammaD}}", "abs": ["{\\left|#1\\right|}", 1], "norm": ["{\\left\\|#1\\right\\|}", 1], "PS": ["{\\left(#1,#2\\right)}", 2], "PSL": ["{\\PS{#1}{#2}_{\\Lo}}", 2], "PSLd": ["{\\PS{#1}{#2}_{\\Lo^d}}", 2], "PSH": ["{\\PS{#1}{#2}_{\\Ho}}", 2], "PSV": ["{\\PS{#1}{#2}_{V}}", 2], "normL": ["{\\norm{#1}_{\\Lo}}", 1], "normLd": ["{\\norm{#1}_{(\\Lo)^d}}", 1], "normH": ["{\\norm{#1}_{\\Ho}}", 1], "normV": ["{\\norm{#1}_{V}}", 1], "ut": "{u_t}", "uh": "{u_h}", "vh": "{v_h}", "Ahh": "{A}", "Bh": "{B}", "Uh": "{U}", "Rb": "{\\mathbb{R}}", "Nb": "{\\mathbb{N}}", "nn": "{\\mathbf{n}}", "dn": "{\\partial_{\\nn}}", "ee": "{\\mathbf{e}}", "xx": "{\\mathbf{x}}", "yy": "{\\mathbf{y}}", "zz": "{\\mathbf{z}}", "diff": "{\\mathrm{d}}", "Cscr": "{\\mathscr{C}}", "Ccal": "{\\mathcal{C}}", "mphi": "{\\varphi}", "mphih": "{\\widehat{\\varphi}}", "psih": "{\\widehat{\\psi}}", "gh": "{\\widehat{g}}", "deltaij": "{\\delta_{ij}}", "tri": "{K}", "trih": "{\\widehat{K}}", "vertice": "{\\mathbf{s}}", "verticeK": ["{\\vertice^{#1}}", 1], "verticeh": "{\\widehat{\\vertice}}", "grandO": ["{O\\left(#1\\right)}", 1], "Nh": "{N_h}", "Ns": "{N_s}", "Nt": "{N_t}", "Pb": "{\\mathbb{P}}", "Sh": "{\\mathscr{S}_h}", "Th": "{\\mathscr{T}_h}", "Ah": "{\\mathscr{A}_h}", "card": "{\\textrm{card}}", "supp": "{\\textrm{supp}}", "diam": "{\\textrm{diam}}", "Image": "{\\textrm{Im}}", "locToGlob": "{\\texttt{L2G}}", "trihToTri": ["{T_{#1}}", 1], "JK": ["{J_{#1}}", 1], "BK": ["{B_{#1}}", 1], "Meh": "{\\widehat{M}^e}", "Deh": "{\\widehat{D}^e}", "Me": ["{M^e_{#1}}", 1], "De": ["{D^e_{#1}}", 1], "enstq": ["{\\left\\{#1 \\mathrel{}\\middle|\\mathrel{}#2\\right\\}}", 2]}}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'numeric/python/sparse';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="next" title="2.2. Gestion du maillage" href="mesh.html" />
    <link rel="prev" title="2. Solveur FEM Python" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="fr"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Passer au contenu principal</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
    <p class="title logo__title">Recueil d'Exercices Classiques de Mathématiques</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Table des matières :</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../lecture/index.html">Notes de cours</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../lecture/numerical-simulation/index.html">1. Simulation Numérique</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/numerical-simulation/EDP.html">1.1. Quelques exemples d’EDP</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/numerical-simulation/industrie.html">1.2. Industrie</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../lecture/weak-solution/index.html">2. Formulations Faibles</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/weak-solution/rappels.html">2.1. Espaces de Hilbert : rappels</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/weak-solution/weak-formulation.html">2.2. Formulation Faible</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/weak-solution/lax-milgram.html">2.3. Théorème de Lax-Milgram</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/weak-solution/sobolev-spaces.html">2.4. Espaces de Sobolev</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/weak-solution/exemple.html">2.5. Application au problème modèle</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../lecture/elements-finis-triangulaires/index.html">3. Éléments Finis Triangulaires</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/elements-finis-triangulaires/galerkin.html">3.1. Méthode de Galerkin</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/elements-finis-triangulaires/espace-p1.html">3.2. Espace <span class="math notranslate nohighlight">\(\Pb^1\)</span>-Lagrange</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/elements-finis-triangulaires/assemblage.html">3.3. Assemblage des Matrices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/elements-finis-triangulaires/contributions-elementaires.html">3.4. Calcul des Matrices Élémentaires</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/elements-finis-triangulaires/matrice-creuse.html">3.5. Matrice Creuse</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../lecture/boundary-conditions/index.html">4. Conditions aux bords</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/boundary-conditions/neumann-heterogene.html">4.1. Conditions de Neumann hétérogène</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/boundary-conditions/dirichlet.html">4.2. Condition de Dirichlet</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/boundary-conditions/fourier.html">4.3. Condition de Fourier</a></li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../lecture/advanced/index.html">5. Avancée</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/advanced/error.html">5.1. Erreur comise et convergence</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../lecture/advanced/p2.html">5.2. Éléments Finis <span class="math notranslate nohighlight">\(\Pb^2\)</span></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../index.html">Implémentation</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../gmsh/index.html">1. Maillage avec GMSH</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../gmsh/mesh.html">1.1. Prise en main de GMSH</a></li>
<li class="toctree-l3"><a class="reference internal" href="../gmsh/api.html">1.2. API GMSH</a></li>
</ul>
</li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="index.html">2. Solveur FEM Python</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l3 current active"><a class="current reference internal" href="#">2.1. Matrices Creuses</a></li>
<li class="toctree-l3"><a class="reference internal" href="mesh.html">2.2. Gestion du maillage</a></li>
<li class="toctree-l3"><a class="reference internal" href="mass-stiffness.html">2.3. Matrices de Masse et de Rigidité</a></li>
<li class="toctree-l3"><a class="reference internal" href="quadrature.html">2.4. Quadratures</a></li>
<li class="toctree-l3"><a class="reference internal" href="dirichlet.html">2.5. Conditions de Dirichlet</a></li>
<li class="toctree-l3"><a class="reference internal" href="solve.html">2.6. Résolution et Analyse</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../projet/index.html">Projet</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../projet/2017-2018/index.html">1. 2017 - 2018 : Wi-Fi</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../projet/2020-2021/index.html">2. 2020 - 2021</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../download/index.html">Version PDF</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apropos/index.html">À propos de ce site</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/Bertbk/course-fem-sphinx">Dépôt GitHub</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Téléchargez cette page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/numeric/python/sparse.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Télécharger le fichier source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimer au format PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Mode plein écran"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="clair/sombre" aria-label="clair/sombre" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Matrices Creuses</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenu </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matrice-coo">2.1.1. Matrice COO</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rappels">2.1.1.1. Rappels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scipy">2.1.1.2. Scipy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#triplets">2.1.1.3. Triplets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#format-csr">2.1.2. Format CSR</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="matrices-creuses">
<h1><span class="section-number">2.1. </span>Matrices Creuses<a class="headerlink" href="#matrices-creuses" title="Lien permanent vers ce titre">#</a></h1>
<p>Le but maintenant est d’implémenter la méthode des éléments finis P1 en 2D, autrement dit, à un maillage donné, de calculer :</p>
<ul class="simple">
<li><p>Les matrices de masse 2D (union de triangles) et 1D (union de segments)</p></li>
<li><p>Les matrices de rigité (union de triangles) et 1D (union de segments)</p></li>
<li><p>Appliquer les conditions de Dirichlet éventuelles</p></li>
<li><p>Approcher des intégrales par des quadratures adaptées</p></li>
</ul>
<p>La matrice du système finale sera stockée sous le format COOrdinate. L’algorithme d’assemblage se prête particulièrement bien au stockage COO puisque la redondance des coefficients est autorisée par Scipy. Autrement dit, les fonctions calculant les matrices de masse et de rigidité retourneront des triplets de type <code class="code docutils literal notranslate"><span class="pre">[I,</span> <span class="pre">J,</span> <span class="pre">Valeur]</span></code> où <code class="code docutils literal notranslate"><span class="pre">I</span></code> est l’indice ligne, <code class="code docutils literal notranslate"><span class="pre">J</span></code> l’indice colonne et <code class="code docutils literal notranslate"><span class="pre">Valeur</span></code> le coefficient (potentiellement partiel).</p>
<p>Avant de résoudre le système, la matrice sera transformée au format Compressed Storage Raw (CSR).</p>
<section id="matrice-coo">
<h2><span class="section-number">2.1.1. </span>Matrice COO<a class="headerlink" href="#matrice-coo" title="Lien permanent vers ce titre">#</a></h2>
<section id="rappels">
<h3><span class="section-number">2.1.1.1. </span>Rappels<a class="headerlink" href="#rappels" title="Lien permanent vers ce titre">#</a></h3>
<p>Le format COO (<em>COOrdinates</em>) propose de ne stocker que les coefficients non nuls d’une matrice <code class="code docutils literal notranslate"><span class="pre">A</span></code> sous la forme de 2 listes d’entiers <code class="code docutils literal notranslate"><span class="pre">row</span></code> et <code class="code docutils literal notranslate"><span class="pre">col</span></code> et une liste de réels <code class="code docutils literal notranslate"><span class="pre">val</span></code>, toutes trois de même taille, telles que</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
<p>Les trois listes peuvent aussi être combinées en une seule liste <code class="code docutils literal notranslate"><span class="pre">data</span></code> de triplets de type <code class="code docutils literal notranslate"><span class="pre">[int,</span> <span class="pre">int,</span> <span class="pre">double]</span></code> et telle que :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">col</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">val</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</pre></div>
</div>
<p>Le format COO est assez permissif :</p>
<ul class="simple">
<li><p>Redondance : si deux triplets possèdent les mêmes indices ligne et colonne alors le coefficient de la matrice, associé à ces indices ligne et colonne, sera obtenu en sommant les valeurs de ces triplets.</p></li>
<li><p>Pas d’ordre : aucune nécessité d’ordonner les triplets selon les lignes ou les colonnes</p></li>
</ul>
<p>Par exemple, les deux jeux de listes ci-dessous décrivent la même maitrce, la seule différence est que le coefficient en (2,2) est scindé en deux et le premier et le dernier triplet ont été permutés :</p>
<table class="table">
<colgroup>
<col style="width: 34%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
<col style="width: 9%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="code docutils literal notranslate"><span class="pre">i</span></code></p></th>
<th class="head"><p>0</p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>2</p></th>
<th class="head"><p>3</p></th>
<th class="head"><p>4</p></th>
<th class="head"><p>5</p></th>
<th class="head"><p>6</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">row[i]</span></code></p></td>
<td><p>0</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">col[i]</span></code></p></td>
<td><p>0</p></td>
<td><p>3</p></td>
<td><p>1</p></td>
<td><p>2</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>3</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">val[i]</span></code></p></td>
<td><p>1.1</p></td>
<td><p>2</p></td>
<td><p>1</p></td>
<td><p>2.3</p></td>
<td><p>0.5</p></td>
<td><p>2</p></td>
<td><p>2</p></td>
</tr>
</tbody>
</table>
<table class="table">
<colgroup>
<col style="width: 27%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 14%" />
<col style="width: 11%" />
<col style="width: 8%" />
<col style="width: 8%" />
<col style="width: 11%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p><code class="code docutils literal notranslate"><span class="pre">i</span></code></p></th>
<th class="head"><p>0</p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>2</p></th>
<th class="head"><p>3</p></th>
<th class="head"><p>4</p></th>
<th class="head"><p>5</p></th>
<th class="head"><p>6</p></th>
<th class="head"><p>7</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">row[i]</span></code></p></td>
<td><p>3</p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p><strong>2</strong></p></td>
<td><p><strong>2</strong></p></td>
<td><p>3</p></td>
<td><p>3</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">col[i]</span></code></p></td>
<td><p>3</p></td>
<td><p>3</p></td>
<td><p>1</p></td>
<td><p><strong>2</strong></p></td>
<td><p><strong>2</strong></p></td>
<td><p>0</p></td>
<td><p>1</p></td>
<td><p>0</p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">val[i]</span></code></p></td>
<td><p>2</p></td>
<td><p>2</p></td>
<td><p>1</p></td>
<td><p><strong>1.3</strong></p></td>
<td><p><strong>1</strong></p></td>
<td><p>0.5</p></td>
<td><p>2</p></td>
<td><p>1.1</p></td>
</tr>
</tbody>
</table>
</section>
<section id="scipy">
<h3><span class="section-number">2.1.1.2. </span>Scipy<a class="headerlink" href="#scipy" title="Lien permanent vers ce titre">#</a></h3>
<p>Pour construire une <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.coo_matrix.html">matrice COO dans Scipy</a> à partir d’un jeu de données <code class="code docutils literal notranslate"><span class="pre">data</span></code>, ce dernier doit être de type <code class="code docutils literal notranslate"><span class="pre">([],</span> <span class="pre">([],[]))</span></code> : un <code class="code docutils literal notranslate"><span class="pre">Tuple</span></code> contenant une <code class="code docutils literal notranslate"><span class="pre">List</span></code> (<code class="code docutils literal notranslate"><span class="pre">val</span></code>) ainsi qu’un <code class="code docutils literal notranslate"><span class="pre">Tuple</span></code> contenant deux <code class="code docutils literal notranslate"><span class="pre">List</span></code> (<code class="code docutils literal notranslate"><span class="pre">row</span></code> et <code class="code docutils literal notranslate"><span class="pre">col</span></code>) (<a class="reference external" href="https://stackoverflow.com/questions/626759/whats-the-difference-between-lists-and-tuples">list vs. tuple ?</a>) :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">))</span>
</pre></div>
</div>
<p>Une matrice COO se construit alors ainsi</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">coo_matrix</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>              <span class="c1"># si data dans le format ci-dessus</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">coo_matrix</span><span class="p">((</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)))</span> <span class="c1"># si row, col et val sont séparées</span>
</pre></div>
</div>
<div class="proof remark admonition" id="remark-0">
<p class="admonition-title"><span class="caption-number">Remark 2.15 </span></p>
<section class="remark-content" id="proof-content">
<p>Une matrice COO peut être visualisée en se transformant en <code class="code docutils literal notranslate"><span class="pre">array</span></code> <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.coo_matrix.html">avec la méthode toarray()</a> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">toarray</span><span class="p">())</span>
</pre></div>
</div>
</section>
</div></section>
<section id="triplets">
<h3><span class="section-number">2.1.1.3. </span>Triplets<a class="headerlink" href="#triplets" title="Lien permanent vers ce titre">#</a></h3>
<div class="mermaid" style="text-align:center;">
  classDiagram
        class Triplets{
          +(float[ ], (int[ ], int[ ])) data
            __init__(self)
            append(self, i, j, val)
        }
</div><p>Nous proposons de construire notre future matrice par concaténation de triplets de type (I, J, valeur). une classe <code class="code docutils literal notranslate"><span class="pre">Triplets</span></code> qui encapsule cette structure de données. Nous lui adjoignons une méthode <code class="code docutils literal notranslate"><span class="pre">append</span></code> permettant d’ajouter un triplet au bout des autres :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Triplets</span> <span class="n">t</span><span class="p">;</span>           <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="c1"># ([], ([], []))</span>
<span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span> <span class="p">,</span><span class="mf">2.</span><span class="p">);</span>  <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="c1"># ([2.], ([0], [1]))</span>
<span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span> <span class="p">,</span><span class="mf">5.2</span><span class="p">);</span> <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="c1"># ([2., 5.2], ([0, 3], [1, 4]))</span>
</pre></div>
</div>
<p>La classe ressemble alors à cela:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">class</span> <span class="n">Triplet</span><span class="p">:</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">():</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">([],</span> <span class="p">([],</span> <span class="p">[]))</span>
  <span class="k">def</span> <span class="fm">__str__</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">I</span><span class="p">,</span> <span class="n">J</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
    <span class="c1"># Ajoute le triplet [I, J, val] dans self.data</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<div class="exercise admonition" id="numeric/python/sparse-exercise-1">

<p class="admonition-title"><span class="caption-number">Exercise 2.1 </span></p>
<section id="exercise-content">
<p>Construisez la classe <code class="code docutils literal notranslate"><span class="pre">Triplet</span></code> et implémentez la méthode <code class="code docutils literal notranslate"><span class="pre">append</span></code>. N’oubliez pas de tester votre classe.</p>
</section>
</div>
<div class="exercise admonition" id="numeric/python/sparse-exercise-2">

<p class="admonition-title"><span class="caption-number">Exercise 2.2 </span></p>
<section id="exercise-content">
<p>Testez votre classe <code class="code docutils literal notranslate"><span class="pre">Triplet</span></code> en construisant la matrice suivante (au format COO évidemment) :</p>
</section>
</div>
<div class="math notranslate nohighlight">
\[\begin{split}A = \begin{pmatrix}
1.1 &amp; 0 &amp; 0 &amp; 2 \\
0 &amp; 1 &amp; 0 &amp; 0  \\
0 &amp; 0 &amp; 2.3 &amp; 0 \\
0.5 &amp; 2 &amp; 0 &amp; 2
\end{pmatrix}\end{split}\]</div>
</section>
</section>
<section id="format-csr">
<h2><span class="section-number">2.1.2. </span>Format CSR<a class="headerlink" href="#format-csr" title="Lien permanent vers ce titre">#</a></h2>
<p>Une fois la matrice au format COO construite, nous la transformerons au format CSR par <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.sparse.coo_matrix.tocsr.html#scipy.sparse.coo_matrix.tocsr">la méthode tocsr()</a> :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">coo_matrix</span><span class="p">((</span><span class="n">val</span><span class="p">,</span> <span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">)))</span><span class="o">.</span><span class="n">tocsr</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="page précédente">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">précédent</p>
        <p class="prev-next-title"><span class="section-number">2. </span>Solveur FEM Python</p>
      </div>
    </a>
    <a class="right-next"
       href="mesh.html"
       title="page suivante">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">suivant</p>
        <p class="prev-next-title"><span class="section-number">2.2. </span>Gestion du maillage</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenu
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#matrice-coo">2.1.1. Matrice COO</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#rappels">2.1.1.1. Rappels</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#scipy">2.1.1.2. Scipy</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#triplets">2.1.1.3. Triplets</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#format-csr">2.1.2. Format CSR</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Par Armand Wayoff
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2024, Bertrand Thierry.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>